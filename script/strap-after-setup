#!/usr/bin/env bash
### ----------------- Bootstrap post-installation scripts ----------------- ###
# Run by run_dotfile_scripts in bootstrap.sh

# Run scripts: scripts must be executable (chmod +x)
echo "-> Running scripts from script/strap-after-setup"

~/.dotfiles/script/symlink.sh

if command -v npm 1>/dev/null; then
  ~/.dotfiles/script/npm_globals.sh
else
  echo "npm not found. Skipping npm_globals.sh."
fi

if [ "$(uname -s)" = "Darwin" ]; then
  ~/.dotfiles/script/macos.sh
else
  echo "Not macOS. Skipping macos.sh."
fi

echo "-> Installing VSCode extensions"
CODE_DISTRO=${CODE_DISTRO:-"code"}
if [ "$(whoami)" = "codespace" ]; then
  echo "Error: Codespaces VSCode CLI can't install extensions."
else
  ~/.dotfiles/script/codium_extensions.sh "$CODE_DISTRO"
fi

# Install Poetry: https://python-poetry.org/docs/
echo "-> Installing Poetry for Python packaging and dependency management"
curl -fsSL \
  https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py |
  python -

# Create directory for Zsh shell functions
mkdir ~/.zfunc

# Set shell
if [ "$SHELL" != "/bin/zsh" ] && which zsh; then
  echo "-> Changing shell to Zsh. Password entry required."
  chsh -s /bin/zsh
else
  echo "-> Shell is already set to Zsh."
fi
